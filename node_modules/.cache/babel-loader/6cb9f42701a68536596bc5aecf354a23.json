{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\thang\\\\Downloads\\\\Code structure\\\\src\\\\modules\\\\auth\\\\pages\\\\UserPage.tsx\",\n    _s = $RefreshSig$();\n\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { fetchThunk } from '../../common/redux/thunk';\nimport { API_PATHS } from '../../../configs/api';\nimport { RESPONSE_STATUS_SUCCESS } from '../../../utils/httpResponseCode';\nimport { ACCESS_TOKEN_KEY, APIUrl } from '../../../utils/constants';\nimport './UserPage.scss';\nimport { logout, setUserInfo } from '../redux/authReducer';\nimport { ROUTES } from '../../../configs/routes';\nimport { replace } from 'connected-react-router';\nimport { Modal, Button } from 'react-bootstrap';\nimport ReactCrop from 'react-image-crop';\nimport 'react-image-crop/dist/ReactCrop.css';\nimport { generateAvatarUpload } from '../../../utils/upload';\nimport Cookies from 'js-cookie';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction UserPage() {\n  _s();\n\n  var _completedCrop$width, _completedCrop$height;\n\n  const dispatch = useDispatch();\n  const [loading, setLoading] = useState(false);\n  const avatarInputRef = useRef(null);\n  const {\n    user\n  } = useSelector(state => state.profile);\n  const [data, setData] = useState();\n  const [image, setImage] = useState(data === null || data === void 0 ? void 0 : data.avatar);\n  const [openModal, setOpenModal] = useState(false);\n  const [crop, setCrop] = useState({\n    unit: '%',\n    width: 30,\n    aspect: 1\n  });\n  const imgRef = useRef(null);\n  const [completedCrop, setCompletedCrop] = useState(null);\n  const previewCanvasRef = useRef(null);\n  const getUser = useCallback(async () => {\n    setLoading(true);\n    const json = await dispatch(fetchThunk(API_PATHS.userProfile, 'get'));\n    setLoading(false);\n\n    if ((json === null || json === void 0 ? void 0 : json.code) === RESPONSE_STATUS_SUCCESS) {\n      setData(json.data);\n    }\n  }, [dispatch]);\n  useEffect(() => {\n    getUser();\n  }, [getUser]);\n\n  const onLogOut = () => {\n    dispatch(logout());\n    dispatch(replace(ROUTES.loginV2));\n  };\n\n  const changeAvatar = () => {\n    if (avatarInputRef.current !== null) avatarInputRef.current.click();\n  };\n\n  const onChooseAvatar = e => {\n    e.preventDefault();\n    const files = e.target.files;\n    const reader = new FileReader();\n\n    reader.onload = () => {\n      setImage(reader.result);\n    };\n\n    if (files !== null && files.length) reader.readAsDataURL(files[0]);\n    setOpenModal(true);\n  };\n\n  const onLoad = useCallback(img => {\n    imgRef.current = img;\n  }, []);\n  useEffect(() => {\n    if (!completedCrop || !previewCanvasRef.current || !imgRef.current) {\n      return;\n    }\n\n    const image = imgRef.current;\n    const canvas = previewCanvasRef.current;\n    const crop = completedCrop;\n    const scaleX = image.naturalWidth / image.width;\n    const scaleY = image.naturalHeight / image.height;\n    const ctx = canvas.getContext('2d');\n    const pixelRatio = window.devicePixelRatio;\n    canvas.width = crop.width * pixelRatio * scaleX;\n    canvas.height = crop.height * pixelRatio * scaleY;\n    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n    ctx.imageSmoothingQuality = 'high';\n    ctx.drawImage(image, crop.x * scaleX, crop.y * scaleY, crop.width * scaleX, crop.height * scaleY, 0, 0, crop.width * scaleX, crop.height * scaleY);\n  }, [completedCrop]);\n\n  const uploadAvatar = async () => {\n    const file = await generateAvatarUpload(previewCanvasRef.current, completedCrop);\n\n    if (file) {\n      const formData = new FormData();\n      formData.append('file', file, file.name);\n      const config = {\n        headers: {\n          'content-type': 'multipart/form-data',\n          Authorization: Cookies.get(ACCESS_TOKEN_KEY) || ''\n        }\n      };\n      console.log(formData);\n      console.log(config);\n      const json = await axios.put(API_PATHS.userProfile, formData, config);\n\n      if (json.data && json.data.code === RESPONSE_STATUS_SUCCESS) {\n        dispatch(setUserInfo(json.data.data));\n      }\n    }\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Loading....\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      style: {\n        margin: 'auto',\n        width: '100%',\n        alignItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"profilepic\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: `${APIUrl}/${user === null || user === void 0 ? void 0 : user.avatar}`,\n          className: \"card-img-top profilepic__image\",\n          alt: \"avatar_url\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"profilepic__content\",\n          onClick: changeAvatar,\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            ref: avatarInputRef,\n            hidden: true,\n            type: \"file\",\n            onChange: onChooseAvatar,\n            accept: \"image/*\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"profilepic__text\",\n            children: \"Upload\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card-body\",\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"card-title\",\n          children: \"Email\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"card-text\",\n          children: user === null || user === void 0 ? void 0 : user.email\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"card-title\",\n          children: \"user Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"card-text\",\n          children: user === null || user === void 0 ? void 0 : user.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"card-title\",\n          children: \"Description\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"card-text\",\n          children: user === null || user === void 0 ? void 0 : user.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"card-title\",\n          children: \"State\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"card-text\",\n          children: user === null || user === void 0 ? void 0 : user.state\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"card-title\",\n          children: \"Region\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"card-text\",\n          children: user === null || user === void 0 ? void 0 : user.region\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-primary\",\n          onClick: onLogOut,\n          children: \"Log Out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      show: openModal,\n      onHide: () => {\n        setOpenModal(false);\n      },\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: \"Upload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: [/*#__PURE__*/_jsxDEV(ReactCrop, {\n          src: image ? image : '',\n          crop: crop,\n          onChange: newCrop => {\n            setCrop(newCrop);\n          },\n          onImageLoaded: onLoad,\n          onComplete: c => setCompletedCrop(c)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: previewCanvasRef,\n            style: {\n              width: Math.round((_completedCrop$width = completedCrop === null || completedCrop === void 0 ? void 0 : completedCrop.width) !== null && _completedCrop$width !== void 0 ? _completedCrop$width : 0),\n              height: Math.round((_completedCrop$height = completedCrop === null || completedCrop === void 0 ? void 0 : completedCrop.height) !== null && _completedCrop$height !== void 0 ? _completedCrop$height : 0)\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          variant: \"secondary\",\n          onClick: () => {\n            setOpenModal(false);\n          },\n          children: \"Close\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          onClick: () => {\n            setOpenModal(false);\n            uploadAvatar();\n          },\n          children: \"Save Image\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n}\n\n_s(UserPage, \"K/piaBZRML/TshYS1OCubdZHMTs=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = UserPage;\nexport default UserPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserPage\");","map":{"version":3,"sources":["C:/Users/thang/Downloads/Code structure/src/modules/auth/pages/UserPage.tsx"],"names":["useDispatch","useSelector","useCallback","useEffect","useRef","useState","fetchThunk","API_PATHS","RESPONSE_STATUS_SUCCESS","ACCESS_TOKEN_KEY","APIUrl","logout","setUserInfo","ROUTES","replace","Modal","Button","ReactCrop","generateAvatarUpload","Cookies","axios","UserPage","dispatch","loading","setLoading","avatarInputRef","user","state","profile","data","setData","image","setImage","avatar","openModal","setOpenModal","crop","setCrop","unit","width","aspect","imgRef","completedCrop","setCompletedCrop","previewCanvasRef","getUser","json","userProfile","code","onLogOut","loginV2","changeAvatar","current","click","onChooseAvatar","e","preventDefault","files","target","reader","FileReader","onload","result","length","readAsDataURL","onLoad","img","canvas","scaleX","naturalWidth","scaleY","naturalHeight","height","ctx","getContext","pixelRatio","window","devicePixelRatio","setTransform","imageSmoothingQuality","drawImage","x","y","uploadAvatar","file","formData","FormData","append","name","config","headers","Authorization","get","console","log","put","margin","alignItems","email","description","region","newCrop","c","Math","round"],"mappings":"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","sourcesContent":["import { useDispatch, useSelector } from 'react-redux';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AppState } from '../../../redux/reducer';\r\nimport { Action } from 'typesafe-actions';\r\nimport { ChangeEvent, useCallback, useEffect, useRef, useState } from 'react';\r\nimport { fetchThunk } from '../../common/redux/thunk';\r\nimport { API_PATHS } from '../../../configs/api';\r\nimport { RESPONSE_STATUS_SUCCESS } from '../../../utils/httpResponseCode';\r\nimport { IUser } from '../../../models/user';\r\nimport { ACCESS_TOKEN_KEY, APIUrl } from '../../../utils/constants';\r\nimport './UserPage.scss';\r\nimport { logout, setUserInfo } from '../redux/authReducer';\r\nimport { ROUTES } from '../../../configs/routes';\r\nimport { replace } from 'connected-react-router';\r\nimport { Modal, Button } from 'react-bootstrap';\r\nimport ReactCrop from 'react-image-crop';\r\nimport 'react-image-crop/dist/ReactCrop.css';\r\nimport { generateAvatarUpload } from '../../../utils/upload';\r\nimport Cookies from 'js-cookie';\r\nimport axios from 'axios';\r\n\r\nfunction UserPage() {\r\n  const dispatch = useDispatch<ThunkDispatch<AppState, null, Action<string>>>();\r\n  const [loading, setLoading] = useState(false);\r\n  const avatarInputRef = useRef<HTMLInputElement>(null);\r\n  const { user } = useSelector((state: AppState) => state.profile);\r\n  const [data, setData] = useState<IUser>();\r\n  const [image, setImage] = useState(data?.avatar);\r\n  const [openModal, setOpenModal] = useState<boolean>(false);\r\n  const [crop, setCrop] = useState<any>({ unit: '%', width: 30, aspect: 1 });\r\n  const imgRef = useRef<any>(null);\r\n  const [completedCrop, setCompletedCrop] = useState<any>(null);\r\n  const previewCanvasRef = useRef<any>(null);\r\n\r\n  const getUser = useCallback(async () => {\r\n    setLoading(true);\r\n    const json = await dispatch(fetchThunk(API_PATHS.userProfile, 'get'));\r\n    setLoading(false);\r\n\r\n    if (json?.code === RESPONSE_STATUS_SUCCESS) {\r\n      setData(json.data);\r\n    }\r\n  }, [dispatch]);\r\n\r\n  useEffect(() => {\r\n    getUser();\r\n  }, [getUser]);\r\n\r\n  const onLogOut = () => {\r\n    dispatch(logout());\r\n    dispatch(replace(ROUTES.loginV2));\r\n  };\r\n\r\n  const changeAvatar = () => {\r\n    if (avatarInputRef.current !== null) avatarInputRef.current.click();\r\n  };\r\n\r\n  const onChooseAvatar = (e: ChangeEvent<HTMLInputElement>) => {\r\n    e.preventDefault();\r\n    const files = e.target.files;\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      setImage(reader.result as any);\r\n    };\r\n    if (files !== null && files.length) reader.readAsDataURL(files[0]);\r\n    setOpenModal(true);\r\n  };\r\n\r\n  const onLoad = useCallback((img: any) => {\r\n    imgRef.current = img;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!completedCrop || !previewCanvasRef.current || !imgRef.current) {\r\n      return;\r\n    }\r\n\r\n    const image = imgRef.current;\r\n    const canvas = previewCanvasRef.current;\r\n    const crop = completedCrop;\r\n\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    const ctx = canvas.getContext('2d');\r\n    const pixelRatio = window.devicePixelRatio;\r\n\r\n    canvas.width = crop.width * pixelRatio * scaleX;\r\n    canvas.height = crop.height * pixelRatio * scaleY;\r\n\r\n    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n    ctx.imageSmoothingQuality = 'high';\r\n\r\n    ctx.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n    );\r\n  }, [completedCrop]);\r\n\r\n  const uploadAvatar = async () => {\r\n    const file = await generateAvatarUpload(previewCanvasRef.current, completedCrop);\r\n    if (file) {\r\n      const formData = new FormData();\r\n      formData.append('file', file, file.name);\r\n      const config = {\r\n        headers: {\r\n          'content-type': 'multipart/form-data',\r\n          Authorization: Cookies.get(ACCESS_TOKEN_KEY) || '',\r\n        },\r\n      };\r\n      console.log(formData);\r\n      console.log(config);\r\n\r\n      const json = await axios.put(API_PATHS.userProfile, formData, config);\r\n      if (json.data && json.data.code === RESPONSE_STATUS_SUCCESS) {\r\n        dispatch(setUserInfo(json.data.data));\r\n      }\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <h3>Loading....</h3>;\r\n  }\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"card\" style={{ margin: 'auto', width: '100%', alignItems: 'center' }}>\r\n        <div className=\"profilepic\">\r\n          <img src={`${APIUrl}/${user?.avatar}`} className=\"card-img-top profilepic__image\" alt=\"avatar_url\" />\r\n          <div className=\"profilepic__content\" onClick={changeAvatar}>\r\n            <input ref={avatarInputRef} hidden type=\"file\" onChange={onChooseAvatar} accept=\"image/*\" />\r\n            <span className=\"profilepic__text\">Upload</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"card-body\">\r\n          <h5 className=\"card-title\">Email</h5>\r\n          <p className=\"card-text\">{user?.email}</p>\r\n          <h5 className=\"card-title\">user Name</h5>\r\n          <p className=\"card-text\">{user?.name}</p>\r\n          <h5 className=\"card-title\">Description</h5>\r\n          <p className=\"card-text\">{user?.description}</p>\r\n          <h5 className=\"card-title\">State</h5>\r\n          <p className=\"card-text\">{user?.state}</p>\r\n          <h5 className=\"card-title\">Region</h5>\r\n          <p className=\"card-text\">{user?.region}</p>\r\n          <button className=\"btn btn-primary\" onClick={onLogOut}>\r\n            Log Out\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <Modal\r\n        show={openModal}\r\n        onHide={() => {\r\n          setOpenModal(false);\r\n        }}\r\n      >\r\n        <Modal.Header>\r\n          <Modal.Title>Upload</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <ReactCrop\r\n            src={image ? image : ''}\r\n            crop={crop}\r\n            onChange={(newCrop: any) => {\r\n              setCrop(newCrop);\r\n            }}\r\n            onImageLoaded={onLoad}\r\n            onComplete={(c) => setCompletedCrop(c)}\r\n          />\r\n          <div>\r\n            <canvas\r\n              ref={previewCanvasRef}\r\n              style={{ width: Math.round(completedCrop?.width ?? 0), height: Math.round(completedCrop?.height ?? 0) }}\r\n            />\r\n          </div>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button\r\n            variant=\"secondary\"\r\n            onClick={() => {\r\n              setOpenModal(false);\r\n            }}\r\n          >\r\n            Close\r\n          </Button>\r\n          <Button\r\n            variant=\"primary\"\r\n            onClick={() => {\r\n              setOpenModal(false);\r\n              uploadAvatar();\r\n            }}\r\n          >\r\n            Save Image\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserPage;\r\n"]},"metadata":{},"sourceType":"module"}