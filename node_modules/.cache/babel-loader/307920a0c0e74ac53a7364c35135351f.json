{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { unstable_useForkRef as useForkRef } from '@mui/utils';\nimport { styled, useTheme } from '@mui/system';\nimport { defaultMemoize } from 'reselect';\nimport { useGridPrivateApiContext } from '../../utils/useGridPrivateApiContext';\nimport { useGridRootProps } from '../../utils/useGridRootProps';\nimport { useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { GridColumnHeaderItem } from '../../../components/columnHeaders/GridColumnHeaderItem';\nimport { getFirstColumnIndexToRender, getTotalHeaderHeight } from '../columns/gridColumnsUtils';\nimport { useGridVisibleRows } from '../../utils/useGridVisibleRows';\nimport { getRenderableIndexes } from '../virtualization/useGridVirtualScroller';\nimport { GridColumnGroupHeader } from '../../../components/columnHeaders/GridColumnGroupHeader';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst GridColumnHeaderRow = styled('div', {\n  name: 'MuiDataGrid',\n  slot: 'ColumnHeaderRow',\n  overridesResolver: (props, styles) => styles.columnHeaderRow\n})(() => ({\n  display: 'flex'\n}));\n\nfunction isUIEvent(event) {\n  return !!event.target;\n}\n\nexport const useGridColumnHeaders = props => {\n  const {\n    innerRef: innerRefProp,\n    minColumnIndex = 0,\n    visibleColumns,\n    sortColumnLookup,\n    filterColumnLookup,\n    columnPositions,\n    columnHeaderTabIndexState,\n    columnGroupHeaderTabIndexState,\n    columnHeaderFocus,\n    columnGroupHeaderFocus,\n    densityFactor,\n    headerGroupingMaxDepth,\n    columnMenuState,\n    columnVisibility,\n    columnGroupsHeaderStructure,\n    hasOtherElementInTabSequence\n  } = props;\n  const theme = useTheme();\n  const [dragCol, setDragCol] = React.useState('');\n  const [resizeCol, setResizeCol] = React.useState('');\n  const apiRef = useGridPrivateApiContext();\n  const rootProps = useGridRootProps();\n  const innerRef = React.useRef(null);\n  const handleInnerRef = useForkRef(innerRefProp, innerRef);\n  const [renderContext, setRenderContext] = React.useState(null);\n  const prevRenderContext = React.useRef(renderContext);\n  const prevScrollLeft = React.useRef(0);\n  const currentPage = useGridVisibleRows(apiRef, rootProps);\n  const totalHeaderHeight = getTotalHeaderHeight(apiRef, rootProps.columnHeaderHeight);\n  const headerHeight = Math.floor(rootProps.columnHeaderHeight * densityFactor);\n  React.useEffect(() => {\n    apiRef.current.columnHeadersContainerElementRef.current.scrollLeft = 0;\n  }, [apiRef]); // memoize `getFirstColumnIndexToRender`, since it's called on scroll\n\n  const getFirstColumnIndexToRenderRef = React.useRef(defaultMemoize(getFirstColumnIndexToRender, {\n    equalityCheck: (a, b) => ['firstColumnIndex', 'minColumnIndex', 'columnBuffer'].every(key => a[key] === b[key])\n  }));\n  const updateInnerPosition = React.useCallback(nextRenderContext => {\n    const [firstRowToRender, lastRowToRender] = getRenderableIndexes({\n      firstIndex: nextRenderContext.firstRowIndex,\n      lastIndex: nextRenderContext.lastRowIndex,\n      minFirstIndex: 0,\n      maxLastIndex: currentPage.rows.length,\n      buffer: rootProps.rowBuffer\n    });\n    const firstColumnToRender = getFirstColumnIndexToRenderRef.current({\n      firstColumnIndex: nextRenderContext.firstColumnIndex,\n      minColumnIndex,\n      columnBuffer: rootProps.columnBuffer,\n      firstRowToRender,\n      lastRowToRender,\n      apiRef,\n      visibleRows: currentPage.rows\n    });\n    const direction = theme.direction === 'ltr' ? 1 : -1;\n    const offset = firstColumnToRender > 0 ? prevScrollLeft.current - direction * columnPositions[firstColumnToRender] : prevScrollLeft.current;\n    innerRef.current.style.transform = `translate3d(${-offset}px, 0px, 0px)`;\n  }, [columnPositions, minColumnIndex, rootProps.columnBuffer, apiRef, currentPage.rows, rootProps.rowBuffer, theme.direction]);\n  React.useLayoutEffect(() => {\n    if (renderContext) {\n      updateInnerPosition(renderContext);\n    }\n  }, [renderContext, updateInnerPosition]);\n  const handleScroll = React.useCallback(({\n    left,\n    renderContext: nextRenderContext = null\n  }, event) => {\n    var _prevRenderContext$cu, _prevRenderContext$cu2;\n\n    if (!innerRef.current) {\n      return;\n    } // Ignore vertical scroll.\n    // Excepts the first event which sets the previous render context.\n\n\n    if (prevScrollLeft.current === left && ((_prevRenderContext$cu = prevRenderContext.current) == null ? void 0 : _prevRenderContext$cu.firstColumnIndex) === (nextRenderContext == null ? void 0 : nextRenderContext.firstColumnIndex) && ((_prevRenderContext$cu2 = prevRenderContext.current) == null ? void 0 : _prevRenderContext$cu2.lastColumnIndex) === (nextRenderContext == null ? void 0 : nextRenderContext.lastColumnIndex)) {\n      return;\n    }\n\n    prevScrollLeft.current = left; // We can only update the position when we guarantee that the render context has been\n    // rendered. This is achieved using ReactDOM.flushSync or when the context doesn't change.\n\n    let canUpdateInnerPosition = false;\n\n    if (nextRenderContext !== prevRenderContext.current || !prevRenderContext.current) {\n      // ReactDOM.flushSync cannot be called on `scroll` events fired inside effects\n      if (isUIEvent(event)) {\n        // To prevent flickering, the inner position can only be updated after the new context has\n        // been rendered. ReactDOM.flushSync ensures that the state changes will happen before\n        // updating the position.\n        ReactDOM.flushSync(() => {\n          setRenderContext(nextRenderContext);\n        });\n        canUpdateInnerPosition = true;\n      } else {\n        setRenderContext(nextRenderContext);\n      }\n\n      prevRenderContext.current = nextRenderContext;\n    } else {\n      canUpdateInnerPosition = true;\n    } // Pass directly the render context to avoid waiting for the next render\n\n\n    if (nextRenderContext && canUpdateInnerPosition) {\n      updateInnerPosition(nextRenderContext);\n    }\n  }, [updateInnerPosition]);\n  const handleColumnResizeStart = React.useCallback(params => setResizeCol(params.field), []);\n  const handleColumnResizeStop = React.useCallback(() => setResizeCol(''), []);\n  const handleColumnReorderStart = React.useCallback(params => setDragCol(params.field), []);\n  const handleColumnReorderStop = React.useCallback(() => setDragCol(''), []);\n  useGridApiEventHandler(apiRef, 'columnResizeStart', handleColumnResizeStart);\n  useGridApiEventHandler(apiRef, 'columnResizeStop', handleColumnResizeStop);\n  useGridApiEventHandler(apiRef, 'columnHeaderDragStart', handleColumnReorderStart);\n  useGridApiEventHandler(apiRef, 'columnHeaderDragEnd', handleColumnReorderStop);\n  useGridApiEventHandler(apiRef, 'scrollPositionChange', handleScroll); // Helper for computation common between getColumnHeaders and getColumnGroupHeaders\n\n  const getColumnsToRender = params => {\n    const {\n      renderContext: nextRenderContext = renderContext,\n      minFirstColumn = minColumnIndex,\n      maxLastColumn = visibleColumns.length\n    } = params || {};\n\n    if (!nextRenderContext) {\n      return null;\n    }\n\n    const [firstRowToRender, lastRowToRender] = getRenderableIndexes({\n      firstIndex: nextRenderContext.firstRowIndex,\n      lastIndex: nextRenderContext.lastRowIndex,\n      minFirstIndex: 0,\n      maxLastIndex: currentPage.rows.length,\n      buffer: rootProps.rowBuffer\n    });\n    const firstColumnToRender = getFirstColumnIndexToRenderRef.current({\n      firstColumnIndex: nextRenderContext.firstColumnIndex,\n      minColumnIndex: minFirstColumn,\n      columnBuffer: rootProps.columnBuffer,\n      apiRef,\n      firstRowToRender,\n      lastRowToRender,\n      visibleRows: currentPage.rows\n    });\n    const lastColumnToRender = Math.min(nextRenderContext.lastColumnIndex + rootProps.columnBuffer, maxLastColumn);\n    const renderedColumns = visibleColumns.slice(firstColumnToRender, lastColumnToRender);\n    return {\n      renderedColumns,\n      firstColumnToRender,\n      lastColumnToRender,\n      minFirstColumn,\n      maxLastColumn\n    };\n  };\n\n  const getColumnHeaders = (params, other = {}) => {\n    const columnsToRender = getColumnsToRender(params);\n\n    if (columnsToRender == null) {\n      return null;\n    }\n\n    const {\n      renderedColumns,\n      firstColumnToRender\n    } = columnsToRender;\n    const columns = [];\n\n    for (let i = 0; i < renderedColumns.length; i += 1) {\n      const colDef = renderedColumns[i];\n      const columnIndex = firstColumnToRender + i;\n      const isFirstColumn = columnIndex === 0;\n      const tabIndex = columnHeaderTabIndexState !== null && columnHeaderTabIndexState.field === colDef.field || isFirstColumn && !hasOtherElementInTabSequence ? 0 : -1;\n      const hasFocus = columnHeaderFocus !== null && columnHeaderFocus.field === colDef.field;\n      const open = columnMenuState.open && columnMenuState.field === colDef.field;\n      columns.push( /*#__PURE__*/_jsx(GridColumnHeaderItem, _extends({}, sortColumnLookup[colDef.field], {\n        columnMenuOpen: open,\n        filterItemsCounter: filterColumnLookup[colDef.field] && filterColumnLookup[colDef.field].length,\n        headerHeight: headerHeight,\n        isDragging: colDef.field === dragCol,\n        colDef: colDef,\n        colIndex: columnIndex,\n        isResizing: resizeCol === colDef.field,\n        hasFocus: hasFocus,\n        tabIndex: tabIndex\n      }, other), colDef.field));\n    }\n\n    return /*#__PURE__*/_jsx(GridColumnHeaderRow, {\n      role: \"row\",\n      \"aria-rowindex\": headerGroupingMaxDepth + 1,\n      ownerState: rootProps,\n      children: columns\n    });\n  };\n\n  const getColumnGroupHeaders = params => {\n    if (headerGroupingMaxDepth === 0) {\n      return null;\n    }\n\n    const columnsToRender = getColumnsToRender(params);\n\n    if (columnsToRender == null || columnsToRender.renderedColumns.length === 0) {\n      return null;\n    }\n\n    const {\n      firstColumnToRender,\n      lastColumnToRender\n    } = columnsToRender;\n    const columns = [];\n    const headerToRender = [];\n\n    for (let depth = 0; depth < headerGroupingMaxDepth; depth += 1) {\n      var _apiRef$current$unsta, _apiRef$current$unsta2;\n\n      const rowStructure = columnGroupsHeaderStructure[depth];\n      const firstColumnFieldToRender = visibleColumns[firstColumnToRender].field;\n      const firstGroupToRender = (_apiRef$current$unsta = apiRef.current.unstable_getColumnGroupPath(firstColumnFieldToRender)[depth]) != null ? _apiRef$current$unsta : null;\n      const firstGroupIndex = rowStructure.findIndex(({\n        groupId,\n        columnFields\n      }) => groupId === firstGroupToRender && columnFields.includes(firstColumnFieldToRender));\n      const lastColumnFieldToRender = visibleColumns[lastColumnToRender - 1].field;\n      const lastGroupToRender = (_apiRef$current$unsta2 = apiRef.current.unstable_getColumnGroupPath(lastColumnFieldToRender)[depth]) != null ? _apiRef$current$unsta2 : null;\n      const lastGroupIndex = rowStructure.findIndex(({\n        groupId,\n        columnFields\n      }) => groupId === lastGroupToRender && columnFields.includes(lastColumnFieldToRender));\n      const visibleColumnGroupHeader = rowStructure.slice(firstGroupIndex, lastGroupIndex + 1).map(groupStructure => {\n        return _extends({}, groupStructure, {\n          columnFields: groupStructure.columnFields.filter(field => columnVisibility[field] !== false)\n        });\n      }).filter(groupStructure => groupStructure.columnFields.length > 0);\n      const firstVisibleColumnIndex = visibleColumnGroupHeader[0].columnFields.indexOf(firstColumnFieldToRender);\n      const hiddenGroupColumns = visibleColumnGroupHeader[0].columnFields.slice(0, firstVisibleColumnIndex);\n      const leftOverflow = hiddenGroupColumns.reduce((acc, field) => {\n        var _column$computedWidth;\n\n        const column = apiRef.current.getColumn(field);\n        return acc + ((_column$computedWidth = column.computedWidth) != null ? _column$computedWidth : 0);\n      }, 0);\n      let columnIndex = firstColumnToRender;\n      const elements = visibleColumnGroupHeader.map(({\n        groupId,\n        columnFields\n      }) => {\n        const hasFocus = columnGroupHeaderFocus !== null && columnGroupHeaderFocus.depth === depth && columnFields.includes(columnGroupHeaderFocus.field);\n        const tabIndex = columnGroupHeaderTabIndexState !== null && columnGroupHeaderTabIndexState.depth === depth && columnFields.includes(columnGroupHeaderTabIndexState.field) ? 0 : -1;\n        const headerInfo = {\n          groupId,\n          width: columnFields.map(field => apiRef.current.getColumn(field).computedWidth).reduce((acc, val) => acc + val, 0),\n          fields: columnFields,\n          colIndex: columnIndex,\n          hasFocus,\n          tabIndex\n        };\n        columnIndex += columnFields.length;\n        return headerInfo;\n      });\n      headerToRender.push({\n        leftOverflow,\n        elements\n      });\n    }\n\n    headerToRender.forEach((depthInfo, depthIndex) => {\n      columns.push( /*#__PURE__*/_jsx(GridColumnHeaderRow, {\n        style: {\n          height: `${headerHeight}px`,\n          transform: `translateX(-${depthInfo.leftOverflow}px)`\n        },\n        role: \"row\",\n        \"aria-rowindex\": depthIndex + 1,\n        ownerState: rootProps,\n        children: depthInfo.elements.map(({\n          groupId,\n          width,\n          fields,\n          colIndex,\n          hasFocus,\n          tabIndex\n        }, groupIndex) => {\n          return /*#__PURE__*/_jsx(GridColumnGroupHeader, {\n            groupId: groupId,\n            width: width,\n            fields: fields,\n            colIndex: colIndex,\n            depth: depthIndex,\n            isLastColumn: colIndex === visibleColumns.length - fields.length,\n            maxDepth: headerToRender.length,\n            height: headerHeight,\n            hasFocus: hasFocus,\n            tabIndex: tabIndex\n          }, groupIndex);\n        })\n      }, depthIndex));\n    });\n    return columns;\n  };\n\n  const rootStyle = {\n    minHeight: totalHeaderHeight,\n    maxHeight: totalHeaderHeight,\n    lineHeight: `${headerHeight}px`\n  };\n  return {\n    renderContext,\n    getColumnHeaders,\n    getColumnGroupHeaders,\n    isDragging: !!dragCol,\n    getRootProps: (other = {}) => _extends({\n      style: rootStyle\n    }, other),\n    getInnerProps: () => ({\n      ref: handleInnerRef,\n      role: 'rowgroup'\n    })\n  };\n};","map":{"version":3,"sources":["C:/Users/thang/Downloads/Code structure/node_modules/@mui/x-data-grid/hooks/features/columnHeaders/useGridColumnHeaders.js"],"names":["_extends","React","ReactDOM","unstable_useForkRef","useForkRef","styled","useTheme","defaultMemoize","useGridPrivateApiContext","useGridRootProps","useGridApiEventHandler","GridColumnHeaderItem","getFirstColumnIndexToRender","getTotalHeaderHeight","useGridVisibleRows","getRenderableIndexes","GridColumnGroupHeader","jsx","_jsx","GridColumnHeaderRow","name","slot","overridesResolver","props","styles","columnHeaderRow","display","isUIEvent","event","target","useGridColumnHeaders","innerRef","innerRefProp","minColumnIndex","visibleColumns","sortColumnLookup","filterColumnLookup","columnPositions","columnHeaderTabIndexState","columnGroupHeaderTabIndexState","columnHeaderFocus","columnGroupHeaderFocus","densityFactor","headerGroupingMaxDepth","columnMenuState","columnVisibility","columnGroupsHeaderStructure","hasOtherElementInTabSequence","theme","dragCol","setDragCol","useState","resizeCol","setResizeCol","apiRef","rootProps","useRef","handleInnerRef","renderContext","setRenderContext","prevRenderContext","prevScrollLeft","currentPage","totalHeaderHeight","columnHeaderHeight","headerHeight","Math","floor","useEffect","current","columnHeadersContainerElementRef","scrollLeft","getFirstColumnIndexToRenderRef","equalityCheck","a","b","every","key","updateInnerPosition","useCallback","nextRenderContext","firstRowToRender","lastRowToRender","firstIndex","firstRowIndex","lastIndex","lastRowIndex","minFirstIndex","maxLastIndex","rows","length","buffer","rowBuffer","firstColumnToRender","firstColumnIndex","columnBuffer","visibleRows","direction","offset","style","transform","useLayoutEffect","handleScroll","left","_prevRenderContext$cu","_prevRenderContext$cu2","lastColumnIndex","canUpdateInnerPosition","flushSync","handleColumnResizeStart","params","field","handleColumnResizeStop","handleColumnReorderStart","handleColumnReorderStop","getColumnsToRender","minFirstColumn","maxLastColumn","lastColumnToRender","min","renderedColumns","slice","getColumnHeaders","other","columnsToRender","columns","i","colDef","columnIndex","isFirstColumn","tabIndex","hasFocus","open","push","columnMenuOpen","filterItemsCounter","isDragging","colIndex","isResizing","role","ownerState","children","getColumnGroupHeaders","headerToRender","depth","_apiRef$current$unsta","_apiRef$current$unsta2","rowStructure","firstColumnFieldToRender","firstGroupToRender","unstable_getColumnGroupPath","firstGroupIndex","findIndex","groupId","columnFields","includes","lastColumnFieldToRender","lastGroupToRender","lastGroupIndex","visibleColumnGroupHeader","map","groupStructure","filter","firstVisibleColumnIndex","indexOf","hiddenGroupColumns","leftOverflow","reduce","acc","_column$computedWidth","column","getColumn","computedWidth","elements","headerInfo","width","val","fields","forEach","depthInfo","depthIndex","height","groupIndex","isLastColumn","maxDepth","rootStyle","minHeight","maxHeight","lineHeight","getRootProps","getInnerProps","ref"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { unstable_useForkRef as useForkRef } from '@mui/utils';\nimport { styled, useTheme } from '@mui/system';\nimport { defaultMemoize } from 'reselect';\nimport { useGridPrivateApiContext } from '../../utils/useGridPrivateApiContext';\nimport { useGridRootProps } from '../../utils/useGridRootProps';\nimport { useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { GridColumnHeaderItem } from '../../../components/columnHeaders/GridColumnHeaderItem';\nimport { getFirstColumnIndexToRender, getTotalHeaderHeight } from '../columns/gridColumnsUtils';\nimport { useGridVisibleRows } from '../../utils/useGridVisibleRows';\nimport { getRenderableIndexes } from '../virtualization/useGridVirtualScroller';\nimport { GridColumnGroupHeader } from '../../../components/columnHeaders/GridColumnGroupHeader';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst GridColumnHeaderRow = styled('div', {\n  name: 'MuiDataGrid',\n  slot: 'ColumnHeaderRow',\n  overridesResolver: (props, styles) => styles.columnHeaderRow\n})(() => ({\n  display: 'flex'\n}));\nfunction isUIEvent(event) {\n  return !!event.target;\n}\nexport const useGridColumnHeaders = props => {\n  const {\n    innerRef: innerRefProp,\n    minColumnIndex = 0,\n    visibleColumns,\n    sortColumnLookup,\n    filterColumnLookup,\n    columnPositions,\n    columnHeaderTabIndexState,\n    columnGroupHeaderTabIndexState,\n    columnHeaderFocus,\n    columnGroupHeaderFocus,\n    densityFactor,\n    headerGroupingMaxDepth,\n    columnMenuState,\n    columnVisibility,\n    columnGroupsHeaderStructure,\n    hasOtherElementInTabSequence\n  } = props;\n  const theme = useTheme();\n  const [dragCol, setDragCol] = React.useState('');\n  const [resizeCol, setResizeCol] = React.useState('');\n  const apiRef = useGridPrivateApiContext();\n  const rootProps = useGridRootProps();\n  const innerRef = React.useRef(null);\n  const handleInnerRef = useForkRef(innerRefProp, innerRef);\n  const [renderContext, setRenderContext] = React.useState(null);\n  const prevRenderContext = React.useRef(renderContext);\n  const prevScrollLeft = React.useRef(0);\n  const currentPage = useGridVisibleRows(apiRef, rootProps);\n  const totalHeaderHeight = getTotalHeaderHeight(apiRef, rootProps.columnHeaderHeight);\n  const headerHeight = Math.floor(rootProps.columnHeaderHeight * densityFactor);\n  React.useEffect(() => {\n    apiRef.current.columnHeadersContainerElementRef.current.scrollLeft = 0;\n  }, [apiRef]);\n\n  // memoize `getFirstColumnIndexToRender`, since it's called on scroll\n  const getFirstColumnIndexToRenderRef = React.useRef(defaultMemoize(getFirstColumnIndexToRender, {\n    equalityCheck: (a, b) => ['firstColumnIndex', 'minColumnIndex', 'columnBuffer'].every(key => a[key] === b[key])\n  }));\n  const updateInnerPosition = React.useCallback(nextRenderContext => {\n    const [firstRowToRender, lastRowToRender] = getRenderableIndexes({\n      firstIndex: nextRenderContext.firstRowIndex,\n      lastIndex: nextRenderContext.lastRowIndex,\n      minFirstIndex: 0,\n      maxLastIndex: currentPage.rows.length,\n      buffer: rootProps.rowBuffer\n    });\n    const firstColumnToRender = getFirstColumnIndexToRenderRef.current({\n      firstColumnIndex: nextRenderContext.firstColumnIndex,\n      minColumnIndex,\n      columnBuffer: rootProps.columnBuffer,\n      firstRowToRender,\n      lastRowToRender,\n      apiRef,\n      visibleRows: currentPage.rows\n    });\n    const direction = theme.direction === 'ltr' ? 1 : -1;\n    const offset = firstColumnToRender > 0 ? prevScrollLeft.current - direction * columnPositions[firstColumnToRender] : prevScrollLeft.current;\n    innerRef.current.style.transform = `translate3d(${-offset}px, 0px, 0px)`;\n  }, [columnPositions, minColumnIndex, rootProps.columnBuffer, apiRef, currentPage.rows, rootProps.rowBuffer, theme.direction]);\n  React.useLayoutEffect(() => {\n    if (renderContext) {\n      updateInnerPosition(renderContext);\n    }\n  }, [renderContext, updateInnerPosition]);\n  const handleScroll = React.useCallback(({\n    left,\n    renderContext: nextRenderContext = null\n  }, event) => {\n    var _prevRenderContext$cu, _prevRenderContext$cu2;\n    if (!innerRef.current) {\n      return;\n    }\n\n    // Ignore vertical scroll.\n    // Excepts the first event which sets the previous render context.\n    if (prevScrollLeft.current === left && ((_prevRenderContext$cu = prevRenderContext.current) == null ? void 0 : _prevRenderContext$cu.firstColumnIndex) === (nextRenderContext == null ? void 0 : nextRenderContext.firstColumnIndex) && ((_prevRenderContext$cu2 = prevRenderContext.current) == null ? void 0 : _prevRenderContext$cu2.lastColumnIndex) === (nextRenderContext == null ? void 0 : nextRenderContext.lastColumnIndex)) {\n      return;\n    }\n    prevScrollLeft.current = left;\n\n    // We can only update the position when we guarantee that the render context has been\n    // rendered. This is achieved using ReactDOM.flushSync or when the context doesn't change.\n    let canUpdateInnerPosition = false;\n    if (nextRenderContext !== prevRenderContext.current || !prevRenderContext.current) {\n      // ReactDOM.flushSync cannot be called on `scroll` events fired inside effects\n      if (isUIEvent(event)) {\n        // To prevent flickering, the inner position can only be updated after the new context has\n        // been rendered. ReactDOM.flushSync ensures that the state changes will happen before\n        // updating the position.\n        ReactDOM.flushSync(() => {\n          setRenderContext(nextRenderContext);\n        });\n        canUpdateInnerPosition = true;\n      } else {\n        setRenderContext(nextRenderContext);\n      }\n      prevRenderContext.current = nextRenderContext;\n    } else {\n      canUpdateInnerPosition = true;\n    }\n\n    // Pass directly the render context to avoid waiting for the next render\n    if (nextRenderContext && canUpdateInnerPosition) {\n      updateInnerPosition(nextRenderContext);\n    }\n  }, [updateInnerPosition]);\n  const handleColumnResizeStart = React.useCallback(params => setResizeCol(params.field), []);\n  const handleColumnResizeStop = React.useCallback(() => setResizeCol(''), []);\n  const handleColumnReorderStart = React.useCallback(params => setDragCol(params.field), []);\n  const handleColumnReorderStop = React.useCallback(() => setDragCol(''), []);\n  useGridApiEventHandler(apiRef, 'columnResizeStart', handleColumnResizeStart);\n  useGridApiEventHandler(apiRef, 'columnResizeStop', handleColumnResizeStop);\n  useGridApiEventHandler(apiRef, 'columnHeaderDragStart', handleColumnReorderStart);\n  useGridApiEventHandler(apiRef, 'columnHeaderDragEnd', handleColumnReorderStop);\n  useGridApiEventHandler(apiRef, 'scrollPositionChange', handleScroll);\n\n  // Helper for computation common between getColumnHeaders and getColumnGroupHeaders\n  const getColumnsToRender = params => {\n    const {\n      renderContext: nextRenderContext = renderContext,\n      minFirstColumn = minColumnIndex,\n      maxLastColumn = visibleColumns.length\n    } = params || {};\n    if (!nextRenderContext) {\n      return null;\n    }\n    const [firstRowToRender, lastRowToRender] = getRenderableIndexes({\n      firstIndex: nextRenderContext.firstRowIndex,\n      lastIndex: nextRenderContext.lastRowIndex,\n      minFirstIndex: 0,\n      maxLastIndex: currentPage.rows.length,\n      buffer: rootProps.rowBuffer\n    });\n    const firstColumnToRender = getFirstColumnIndexToRenderRef.current({\n      firstColumnIndex: nextRenderContext.firstColumnIndex,\n      minColumnIndex: minFirstColumn,\n      columnBuffer: rootProps.columnBuffer,\n      apiRef,\n      firstRowToRender,\n      lastRowToRender,\n      visibleRows: currentPage.rows\n    });\n    const lastColumnToRender = Math.min(nextRenderContext.lastColumnIndex + rootProps.columnBuffer, maxLastColumn);\n    const renderedColumns = visibleColumns.slice(firstColumnToRender, lastColumnToRender);\n    return {\n      renderedColumns,\n      firstColumnToRender,\n      lastColumnToRender,\n      minFirstColumn,\n      maxLastColumn\n    };\n  };\n  const getColumnHeaders = (params, other = {}) => {\n    const columnsToRender = getColumnsToRender(params);\n    if (columnsToRender == null) {\n      return null;\n    }\n    const {\n      renderedColumns,\n      firstColumnToRender\n    } = columnsToRender;\n    const columns = [];\n    for (let i = 0; i < renderedColumns.length; i += 1) {\n      const colDef = renderedColumns[i];\n      const columnIndex = firstColumnToRender + i;\n      const isFirstColumn = columnIndex === 0;\n      const tabIndex = columnHeaderTabIndexState !== null && columnHeaderTabIndexState.field === colDef.field || isFirstColumn && !hasOtherElementInTabSequence ? 0 : -1;\n      const hasFocus = columnHeaderFocus !== null && columnHeaderFocus.field === colDef.field;\n      const open = columnMenuState.open && columnMenuState.field === colDef.field;\n      columns.push( /*#__PURE__*/_jsx(GridColumnHeaderItem, _extends({}, sortColumnLookup[colDef.field], {\n        columnMenuOpen: open,\n        filterItemsCounter: filterColumnLookup[colDef.field] && filterColumnLookup[colDef.field].length,\n        headerHeight: headerHeight,\n        isDragging: colDef.field === dragCol,\n        colDef: colDef,\n        colIndex: columnIndex,\n        isResizing: resizeCol === colDef.field,\n        hasFocus: hasFocus,\n        tabIndex: tabIndex\n      }, other), colDef.field));\n    }\n    return /*#__PURE__*/_jsx(GridColumnHeaderRow, {\n      role: \"row\",\n      \"aria-rowindex\": headerGroupingMaxDepth + 1,\n      ownerState: rootProps,\n      children: columns\n    });\n  };\n  const getColumnGroupHeaders = params => {\n    if (headerGroupingMaxDepth === 0) {\n      return null;\n    }\n    const columnsToRender = getColumnsToRender(params);\n    if (columnsToRender == null || columnsToRender.renderedColumns.length === 0) {\n      return null;\n    }\n    const {\n      firstColumnToRender,\n      lastColumnToRender\n    } = columnsToRender;\n    const columns = [];\n    const headerToRender = [];\n    for (let depth = 0; depth < headerGroupingMaxDepth; depth += 1) {\n      var _apiRef$current$unsta, _apiRef$current$unsta2;\n      const rowStructure = columnGroupsHeaderStructure[depth];\n      const firstColumnFieldToRender = visibleColumns[firstColumnToRender].field;\n      const firstGroupToRender = (_apiRef$current$unsta = apiRef.current.unstable_getColumnGroupPath(firstColumnFieldToRender)[depth]) != null ? _apiRef$current$unsta : null;\n      const firstGroupIndex = rowStructure.findIndex(({\n        groupId,\n        columnFields\n      }) => groupId === firstGroupToRender && columnFields.includes(firstColumnFieldToRender));\n      const lastColumnFieldToRender = visibleColumns[lastColumnToRender - 1].field;\n      const lastGroupToRender = (_apiRef$current$unsta2 = apiRef.current.unstable_getColumnGroupPath(lastColumnFieldToRender)[depth]) != null ? _apiRef$current$unsta2 : null;\n      const lastGroupIndex = rowStructure.findIndex(({\n        groupId,\n        columnFields\n      }) => groupId === lastGroupToRender && columnFields.includes(lastColumnFieldToRender));\n      const visibleColumnGroupHeader = rowStructure.slice(firstGroupIndex, lastGroupIndex + 1).map(groupStructure => {\n        return _extends({}, groupStructure, {\n          columnFields: groupStructure.columnFields.filter(field => columnVisibility[field] !== false)\n        });\n      }).filter(groupStructure => groupStructure.columnFields.length > 0);\n      const firstVisibleColumnIndex = visibleColumnGroupHeader[0].columnFields.indexOf(firstColumnFieldToRender);\n      const hiddenGroupColumns = visibleColumnGroupHeader[0].columnFields.slice(0, firstVisibleColumnIndex);\n      const leftOverflow = hiddenGroupColumns.reduce((acc, field) => {\n        var _column$computedWidth;\n        const column = apiRef.current.getColumn(field);\n        return acc + ((_column$computedWidth = column.computedWidth) != null ? _column$computedWidth : 0);\n      }, 0);\n      let columnIndex = firstColumnToRender;\n      const elements = visibleColumnGroupHeader.map(({\n        groupId,\n        columnFields\n      }) => {\n        const hasFocus = columnGroupHeaderFocus !== null && columnGroupHeaderFocus.depth === depth && columnFields.includes(columnGroupHeaderFocus.field);\n        const tabIndex = columnGroupHeaderTabIndexState !== null && columnGroupHeaderTabIndexState.depth === depth && columnFields.includes(columnGroupHeaderTabIndexState.field) ? 0 : -1;\n        const headerInfo = {\n          groupId,\n          width: columnFields.map(field => apiRef.current.getColumn(field).computedWidth).reduce((acc, val) => acc + val, 0),\n          fields: columnFields,\n          colIndex: columnIndex,\n          hasFocus,\n          tabIndex\n        };\n        columnIndex += columnFields.length;\n        return headerInfo;\n      });\n      headerToRender.push({\n        leftOverflow,\n        elements\n      });\n    }\n    headerToRender.forEach((depthInfo, depthIndex) => {\n      columns.push( /*#__PURE__*/_jsx(GridColumnHeaderRow, {\n        style: {\n          height: `${headerHeight}px`,\n          transform: `translateX(-${depthInfo.leftOverflow}px)`\n        },\n        role: \"row\",\n        \"aria-rowindex\": depthIndex + 1,\n        ownerState: rootProps,\n        children: depthInfo.elements.map(({\n          groupId,\n          width,\n          fields,\n          colIndex,\n          hasFocus,\n          tabIndex\n        }, groupIndex) => {\n          return /*#__PURE__*/_jsx(GridColumnGroupHeader, {\n            groupId: groupId,\n            width: width,\n            fields: fields,\n            colIndex: colIndex,\n            depth: depthIndex,\n            isLastColumn: colIndex === visibleColumns.length - fields.length,\n            maxDepth: headerToRender.length,\n            height: headerHeight,\n            hasFocus: hasFocus,\n            tabIndex: tabIndex\n          }, groupIndex);\n        })\n      }, depthIndex));\n    });\n    return columns;\n  };\n  const rootStyle = {\n    minHeight: totalHeaderHeight,\n    maxHeight: totalHeaderHeight,\n    lineHeight: `${headerHeight}px`\n  };\n  return {\n    renderContext,\n    getColumnHeaders,\n    getColumnGroupHeaders,\n    isDragging: !!dragCol,\n    getRootProps: (other = {}) => _extends({\n      style: rootStyle\n    }, other),\n    getInnerProps: () => ({\n      ref: handleInnerRef,\n      role: 'rowgroup'\n    })\n  };\n};"]},"metadata":{},"sourceType":"module"}